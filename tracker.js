(function(_){typeof define=="function"&&define.amd?define(_):_()})(function(){"use strict";function _(){return crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substr(2,10)}function p(t,e,o){document.cookie=`${t}=${e}; path=/; max-age=${o}`}function d(t){if(typeof document>"u")return null;const o=document.cookie.split("; ").map(n=>n.trim()).find(n=>n.startsWith(`${t}=`));return o?o.split("=")[1]:null}const a=Object.freeze({PAGE_VIEW:"pageview",SESSION_START:"session_start",SESSION_END:"session_end",SCROLL_DEPTH:"scroll_depth",TIME_ON_PAGE:"time_on_page",CLICK:"click",FORM_VIEW:"form_view",FORM_FOCUS:"form_focus",FORM_SUBMIT:"form_submit",OUTBOUND_LINK_CLICK:"outbound_link_click",VIDEO_PLAY:"video_play",VIDEO_PAUSE:"video_pause",VIDEO_WATCH_PERCENTAGE:"video_watch_percentage",DOWNLOAD:"download"});function E(){if(!d("jw_user_id")){const n=_();p("jw_user_id",n,31536e3)}if(!d("jw_session_id")){const n=_();return p("jw_session_id",n,1800),!0}return!1}function h(){if(typeof window>"u"||typeof document>"u")return!1;const t=typeof navigator<"u"&&navigator.doNotTrack==="1",e=document.cookie.includes("jw_opt_out=true"),o=window.JourneyWiseConsentGiven===!1;return!t&&!e&&!o}function y(){let t=localStorage.getItem("jw_device_id");return t||(t=_(),localStorage.setItem("jw_device_id",t)),t}const S="https://flight.journeywise.io/api/v1/website-event-tracking";function r(t,e){var s,u,c,l;if(!h()||window.JourneyWiseConsentGiven===!1){console.warn("[JourneyWise] Tracking skipped: user opted out or DNT enabled.");return}const o=d("jw_user_id"),n=d("jw_user_id"),i={identifier:t,pageview_id:409606162,platform:"web",user_data:{anonymous_id:o,workEmail:((s=e==null?void 0:e.fields)==null?void 0:s.workEmail)||void 0,firstName:((u=e==null?void 0:e.fields)==null?void 0:u.firstName)||void 0,lastName:((c=e==null?void 0:e.fields)==null?void 0:c.lastName)||void 0,phone:((l=e==null?void 0:e.fields)==null?void 0:l.phoneNumber)||void 0},event:"Website Activity",subEvent:t,metadata:{additional_data:e},referer:e!=null&&e.url?e.url:document.referrer,device_identifier:n,apiKey:window.__JW_API_KEY__||""};fetch(S,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).catch(w=>{console.warn("Failed to send JourneyWise event:",w)})}function g(t){const e={};for(const[o,n]of t.entries())o.toLowerCase(),e[o]=n;return e}let f=Date.now();const D=E();function m(){r(a.PAGE_VIEW,{url:location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:Date.now()}),D&&b(),T(),O(),k(),A()}function k(){const t=window.__JW_API_KEY__;!t||!h()||r("test_connection",{apiKey:t,page_url:location.href,hostname:location.hostname,user_agent:navigator.userAgent,referrer:document.referrer,timestamp:Date.now()})}function b(){const t=d("jw_session_id");r(a.SESSION_START,{session_id:t,timestamp:Date.now()})}function A(){const t=[25,50,75,100],e=new Set;window.addEventListener("scroll",()=>{const o=window.scrollY,n=document.documentElement.scrollHeight-window.innerHeight,i=Math.round(o/n*100);t.forEach(s=>{i>=s&&!e.has(s)&&(e.add(s),r(a.SCROLL_DEPTH,{percent:s,url:location.href,timestamp:Date.now()}))}),f=Date.now()})}function O(){setInterval(()=>{const t=Date.now(),e=Math.floor((t-f)/1e3);r(a.TIME_ON_PAGE,{time_spent:e,url:location.href,session_id:d("jw_session_id"),timestamp:Date.now()})},3e4)}function T(){setInterval(()=>{const e=Date.now();e-f>=5*60*1e3&&r(a.SESSION_END,{session_id:d("jw_session_id"),timestamp:e})},6e4)}function N(){const t=new WeakSet,e=i=>{if(t.has(i))return;t.add(i);const s=i.id||i.name||"unnamed_form";i.addEventListener("submit",u=>{var I;const c=u.submitter;if(!(c&&(c.formNoValidate||((I=c.hasAttribute)==null?void 0:I.call(c,"formnovalidate"))))&&!i.checkValidity())return;const w=new FormData(i),M=g(w);r(a.FORM_SUBMIT,{form_id:s,title:i.title||"Unnamed Form",status:"submitted",fields:M,url:location.href,submit_url:i.action||null,timestamp:Date.now()})})},o=()=>{document.querySelectorAll("form").forEach(e)};o(),new MutationObserver(o).observe(document.body,{childList:!0,subtree:!0})}function L(){const t=["pdf","zip","png","jpg","jpeg","doc","docx","xls","xlsx"];document.addEventListener("click",e=>{const o=e.target.closest("a");if(!o)return;const n=o.getAttribute("href");if(!n)return;const i=new URL(n,location.href),s=i.pathname.split(".").pop().toLowerCase(),u=o.hasAttribute("download"),c=t.includes(s);(u||c)&&r(a.DOWNLOAD,{file_name:i.pathname.split("/").pop(),file_url:i.href,file_extension:s,element_type:"A",page_url:location.href,timestamp:Date.now()})})}function C(){const t=new Set,e=()=>{document.querySelectorAll("video").forEach(n=>{if(t.has(n))return;t.add(n);const i=n.id||"unnamed_video";let s=[25,50,75,100],u=new Set;n.addEventListener("play",()=>{r(a.VIDEO_PLAY,{video_id:i,timestamp:Date.now()})}),n.addEventListener("pause",()=>{r(a.VIDEO_PAUSE,{video_id:i,current_time:n.currentTime,timestamp:Date.now()})}),n.addEventListener("timeupdate",()=>{const c=Math.floor(n.currentTime/n.duration*100);s.forEach(l=>{c>=l&&!u.has(l)&&(u.add(l),r(a.VIDEO_WATCH_PERCENTAGE,{video_id:i,percent_watched:l,timestamp:Date.now()}))})})})};new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0}),e()}function P(t,e={}){const o={...e,url:location.href,timestamp:Date.now(),visitor_id:d("jw_user_id"),session_id:d("jw_session_id"),device_identifier:y()};r(t,o)}function v(t,...e){switch(t){case"init":window.__JW_API_KEY__=e[0];break;case"track":P(...e);break;default:console.warn(`Unknown JourneyWise command: ${t}`)}}function W(t){t.forEach(e=>v(...e))}function j(){const t=history.pushState;history.pushState=function(...e){t.apply(history,e),m()},window.addEventListener("popstate",m)}(function(){var o;const e=((o=window.JourneyWise)==null?void 0:o.q)||[];window.JourneyWise=function(...n){v(...n)},window.JourneyWise.q=e,W(e),E(),setTimeout(()=>{m(),C(),L(),N(),j()},1e3)})()});
