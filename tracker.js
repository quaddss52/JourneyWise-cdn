(function(l){typeof define=="function"&&define.amd?define(l):l()})(function(){"use strict";function l(){return crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substr(2,10)}function w(n,e,t){document.cookie=`${n}=${e}; path=/; max-age=${t}`}function a(n){if(typeof document>"u")return null;const t=document.cookie.split("; ").map(o=>o.trim()).find(o=>o.startsWith(`${n}=`));return t?t.split("=")[1]:null}const c=Object.freeze({PAGE_VIEW:"pageview",SESSION_START:"session_start",SESSION_END:"session_end",SCROLL_DEPTH:"scroll_depth",TIME_ON_PAGE:"time_on_page",CLICK:"click",FORM_VIEW:"form_view",FORM_FOCUS:"form_focus",FORM_SUBMIT:"form_submit",OUTBOUND_LINK_CLICK:"outbound_link_click",VIDEO_PLAY:"video_play",VIDEO_PAUSE:"video_pause",VIDEO_WATCH_PERCENTAGE:"video_watch_percentage",DOWNLOAD:"download"});function p(){if(!a("jw_user_id")){const o=l();w("jw_user_id",o,31536e3)}if(!a("jw_session_id")){const o=l();return w("jw_session_id",o,1800),!0}return!1}function E(){if(typeof window>"u"||typeof document>"u")return!1;const n=typeof navigator<"u"&&navigator.doNotTrack==="1",e=document.cookie.includes("jw_opt_out=true"),t=window.JourneyWiseConsentGiven===!1;return!n&&!e&&!t}function v(){let n=localStorage.getItem("jw_device_id");return n||(n=l(),localStorage.setItem("jw_device_id",n)),n}const I="https://flight.journeywise.io/api/v1/website-event-tracking";function r(n,e){var i,d,_,u;if(!E()||window.JourneyWiseConsentGiven===!1){console.warn("[JourneyWise] Tracking skipped: user opted out or DNT enabled.");return}const t=a("jw_user_id"),o=a("jw_user_id"),s={identifier:n,pageview_id:409606162,platform:"web",user_data:{anonymous_id:t,workEmail:((i=e==null?void 0:e.fields)==null?void 0:i.workEmail)||void 0,firstName:((d=e==null?void 0:e.fields)==null?void 0:d.firstName)||void 0,lastName:((_=e==null?void 0:e.fields)==null?void 0:_.lastName)||void 0,phone:((u=e==null?void 0:e.fields)==null?void 0:u.phoneNumber)||void 0},event:"Website Activity",subEvent:n,metadata:{additional_data:e},referer:e!=null&&e.url?e.url:document.referrer,device_identifier:o,apiKey:window.__JW_API_KEY__||""};fetch(I,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).catch(W=>{console.warn("Failed to send JourneyWise event:",W)})}function g(n){const e={};for(const[t,o]of n.entries())t.toLowerCase(),e[t]=o;return e}let f=Date.now();const y=p();function m(){r(c.PAGE_VIEW,{url:location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:Date.now()}),y&&S(),T(),O(),D(),k()}function D(){const n=window.__JW_API_KEY__;!n||!E()||r("test_connection",{apiKey:n,page_url:location.href,hostname:location.hostname,user_agent:navigator.userAgent,referrer:document.referrer,timestamp:Date.now()})}function S(){const n=a("jw_session_id");r(c.SESSION_START,{session_id:n,timestamp:Date.now()})}function k(){const n=[25,50,75,100],e=new Set;window.addEventListener("scroll",()=>{const t=window.scrollY,o=document.documentElement.scrollHeight-window.innerHeight,s=Math.round(t/o*100);n.forEach(i=>{s>=i&&!e.has(i)&&(e.add(i),r(c.SCROLL_DEPTH,{percent:i,url:location.href,timestamp:Date.now()}))}),f=Date.now()})}function O(){setInterval(()=>{const n=Date.now(),e=Math.floor((n-f)/1e3);r(c.TIME_ON_PAGE,{time_spent:e,url:location.href,session_id:a("jw_session_id"),timestamp:Date.now()})},3e4)}function T(){setInterval(()=>{const e=Date.now();e-f>=5*60*1e3&&r(c.SESSION_END,{session_id:a("jw_session_id"),timestamp:e})},6e4)}function A(){const n=()=>{document.querySelectorAll("form").forEach(t=>{const o=t.id||t.name||"unnamed_form";t.addEventListener("submit",s=>{s.preventDefault();const i=new FormData(t),d=g(i);r(c.FORM_SUBMIT,{form_id:o,title:t.title||"Unnamed Form",status:"submitted",fields:d,url:location.href,submit_url:t.action||null,timestamp:Date.now()})})})};new MutationObserver(n).observe(document.body,{childList:!0,subtree:!0}),n()}function b(){const n=["pdf","zip","png","jpg","jpeg","doc","docx","xls","xlsx"];document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t)return;const o=t.getAttribute("href");if(!o)return;const s=new URL(o,location.href),i=s.pathname.split(".").pop().toLowerCase(),d=t.hasAttribute("download"),_=n.includes(i);(d||_)&&r(c.DOWNLOAD,{file_name:s.pathname.split("/").pop(),file_url:s.href,file_extension:i,element_type:"A",page_url:location.href,timestamp:Date.now()})})}function N(){const n=new Set,e=()=>{document.querySelectorAll("video").forEach(o=>{if(n.has(o))return;n.add(o);const s=o.id||"unnamed_video";let i=[25,50,75,100],d=new Set;o.addEventListener("play",()=>{r(c.VIDEO_PLAY,{video_id:s,timestamp:Date.now()})}),o.addEventListener("pause",()=>{r(c.VIDEO_PAUSE,{video_id:s,current_time:o.currentTime,timestamp:Date.now()})}),o.addEventListener("timeupdate",()=>{const _=Math.floor(o.currentTime/o.duration*100);i.forEach(u=>{_>=u&&!d.has(u)&&(d.add(u),r(c.VIDEO_WATCH_PERCENTAGE,{video_id:s,percent_watched:u,timestamp:Date.now()}))})})})};new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0}),e()}function L(n,e={}){const t={...e,url:location.href,timestamp:Date.now(),visitor_id:a("jw_user_id"),session_id:a("jw_session_id"),device_identifier:v()};r(n,t)}function h(n,...e){switch(n){case"init":window.__JW_API_KEY__=e[0];break;case"track":L(...e);break;default:console.warn(`Unknown JourneyWise command: ${n}`)}}function C(n){n.forEach(e=>h(...e))}function P(){const n=history.pushState;history.pushState=function(...e){n.apply(history,e),m()},window.addEventListener("popstate",m)}(function(){var t;const e=((t=window.JourneyWise)==null?void 0:t.q)||[];window.JourneyWise=function(...o){h(...o)},window.JourneyWise.q=e,C(e),p(),setTimeout(()=>{m(),N(),b(),A(),P()},1e3)})()});
