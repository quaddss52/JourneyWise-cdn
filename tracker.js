(function(_){typeof define=="function"&&define.amd?define(_):_()})(function(){"use strict";function _(){return crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substr(2,10)}function g(t,e,n){document.cookie=`${t}=${e}; path=/; max-age=${n}`}function u(t){if(typeof document>"u")return null;const n=document.cookie.split("; ").map(o=>o.trim()).find(o=>o.startsWith(`${t}=`));return n?n.split("=")[1]:null}const a=Object.freeze({PAGE_VIEW:"pageview",SESSION_START:"session_start",SESSION_END:"session_end",SCROLL_DEPTH:"scroll_depth",TIME_ON_PAGE:"time_on_page",CLICK:"click",FORM_VIEW:"form_view",FORM_FOCUS:"form_focus",FORM_SUBMIT:"form_submit",OUTBOUND_LINK_CLICK:"outbound_link_click",VIDEO_PLAY:"video_play",VIDEO_PAUSE:"video_pause",VIDEO_WATCH_PERCENTAGE:"video_watch_percentage",DOWNLOAD:"download"});function h(){if(!u("jw_user_id")){const o=_();g("jw_user_id",o,31536e3)}if(!u("jw_session_id")){const o=_();return g("jw_session_id",o,1800),!0}return!1}function E(){if(typeof window>"u"||typeof document>"u")return!1;const t=typeof navigator<"u"&&navigator.doNotTrack==="1",e=document.cookie.includes("jw_opt_out=true"),n=window.JourneyWiseConsentGiven===!1;return!t&&!e&&!n}function y(){let t=localStorage.getItem("jw_device_id");return t||(t=_(),localStorage.setItem("jw_device_id",t)),t}function v(){const t=JSON.parse(sessionStorage.getItem("jw_campaign_origin"));if(t)return t;const e=new URLSearchParams(window.location.search);let n=null;if(n={utm_source:e.get("utm_source"),utm_medium:e.get("utm_medium"),utm_campaign:e.get("utm_campaign"),utm_term:e.get("utm_term"),utm_content:e.get("utm_content")},!n&&document.referrer)try{const o=new URL(document.referrer),i=new URL(window.location.href);o.hostname!==i.hostname&&(n=`referrer:${o.hostname}`)}catch{}return n&&sessionStorage.setItem("jw_campaign_origin",JSON.stringify(n)),n}const k="https://flight.journeywise.io/api/v1/website-event-tracking";function r(t,e){var d,c,l,f;if(!E()||window.JourneyWiseConsentGiven===!1){console.warn("[JourneyWise] Tracking skipped: user opted out or DNT enabled.");return}const n=u("jw_user_id"),o=u("jw_user_id"),i=JSON.parse(v()),s={identifier:t,pageview_id:409606162,platform:"web",utm_tracking:i,user_data:{anonymous_id:n,workEmail:((d=e==null?void 0:e.fields)==null?void 0:d.workEmail)||void 0,firstName:((c=e==null?void 0:e.fields)==null?void 0:c.firstName)||void 0,lastName:((l=e==null?void 0:e.fields)==null?void 0:l.lastName)||void 0,phone:((f=e==null?void 0:e.fields)==null?void 0:f.phoneNumber)||void 0},event:"Website Activity",subEvent:t,metadata:{additional_data:{...e}},referer:e!=null&&e.url?e.url:document.referrer,device_identifier:o,apiKey:window.__JW_API_KEY__||""};fetch(k,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).catch(p=>{console.warn("Failed to send JourneyWise event:",p)})}function D(t){const e={};for(const[n,o]of t.entries())n.toLowerCase(),e[n]=o;return e}let m=Date.now();const O=h();function w(){r(a.PAGE_VIEW,{url:location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:Date.now()}),O&&A(),L(),N(),b(),T()}function b(){const t=window.__JW_API_KEY__;!t||!E()||r("test_connection",{apiKey:t,page_url:location.href,hostname:location.hostname,user_agent:navigator.userAgent,referrer:document.referrer,timestamp:Date.now()})}function A(){const t=u("jw_session_id");r(a.SESSION_START,{session_id:t,timestamp:Date.now()})}function T(){const t=[25,50,75,100],e=new Set;window.addEventListener("scroll",()=>{const n=window.scrollY,o=document.documentElement.scrollHeight-window.innerHeight,i=Math.round(n/o*100);t.forEach(s=>{i>=s&&!e.has(s)&&(e.add(s),r(a.SCROLL_DEPTH,{percent:s,url:location.href,timestamp:Date.now()}))}),m=Date.now()})}function N(){setInterval(()=>{const t=Date.now(),e=Math.floor((t-m)/1e3);r(a.TIME_ON_PAGE,{time_spent:e,url:location.href,session_id:u("jw_session_id"),timestamp:Date.now()})},3e4)}function L(){setInterval(()=>{const e=Date.now();e-m>=5*60*1e3&&r(a.SESSION_END,{session_id:u("jw_session_id"),timestamp:e})},6e4)}function P(){const t=new WeakSet,e=i=>{if(t.has(i))return;t.add(i);const s=i.id||i.name||"unnamed_form";i.addEventListener("submit",d=>{var I;const c=d.submitter;if(!(c&&(c.formNoValidate||((I=c.hasAttribute)==null?void 0:I.call(c,"formnovalidate"))))&&!i.checkValidity())return;const f=new FormData(i),p=D(f);r(a.FORM_SUBMIT,{form_id:s,title:i.title||"Unnamed Form",status:"submitted",fields:p,url:location.href,submit_url:i.action||null,timestamp:Date.now()})})},n=()=>{document.querySelectorAll("form").forEach(e)};n(),new MutationObserver(n).observe(document.body,{childList:!0,subtree:!0})}function C(){const t=["pdf","zip","png","jpg","jpeg","doc","docx","xls","xlsx"];document.addEventListener("click",e=>{const n=e.target.closest("a");if(!n)return;const o=n.getAttribute("href");if(!o)return;const i=new URL(o,location.href),s=i.pathname.split(".").pop().toLowerCase(),d=n.hasAttribute("download"),c=t.includes(s);(d||c)&&r(a.DOWNLOAD,{file_name:i.pathname.split("/").pop(),file_url:i.href,file_extension:s,element_type:"A",page_url:location.href,timestamp:Date.now()})})}function j(){const t=new Set,e=()=>{document.querySelectorAll("video").forEach(o=>{if(t.has(o))return;t.add(o);const i=o.id||"unnamed_video";let s=[25,50,75,100],d=new Set;o.addEventListener("play",()=>{r(a.VIDEO_PLAY,{video_id:i,timestamp:Date.now()})}),o.addEventListener("pause",()=>{r(a.VIDEO_PAUSE,{video_id:i,current_time:o.currentTime,timestamp:Date.now()})}),o.addEventListener("timeupdate",()=>{const c=Math.floor(o.currentTime/o.duration*100);s.forEach(l=>{c>=l&&!d.has(l)&&(d.add(l),r(a.VIDEO_WATCH_PERCENTAGE,{video_id:i,percent_watched:l,timestamp:Date.now()}))})})})};new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0}),e()}function W(t,e={}){const n={...e,url:location.href,timestamp:Date.now(),visitor_id:u("jw_user_id"),session_id:u("jw_session_id"),device_identifier:y()};r(t,n)}function S(t,...e){switch(t){case"init":window.__JW_API_KEY__=e[0];break;case"track":W(...e);break;default:console.warn(`Unknown JourneyWise command: ${t}`)}}function U(t){t.forEach(e=>S(...e))}function R(){const t=history.pushState;history.pushState=function(...e){t.apply(history,e),w()},window.addEventListener("popstate",w)}(function(){var n;const e=((n=window.JourneyWise)==null?void 0:n.q)||[];window.JourneyWise=function(...o){S(...o)},window.JourneyWise.q=e,U(e),h(),setTimeout(()=>{w(),v(),j(),C(),P(),R()},1e3)})()});
