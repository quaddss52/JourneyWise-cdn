(function(_){typeof define=="function"&&define.amd?define(_):_()})(function(){"use strict";function _(){return crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substr(2,10)}function p(t,e,i){document.cookie=`${t}=${e}; path=/; max-age=${i}`}function u(t){if(typeof document>"u")return null;const i=document.cookie.split("; ").map(n=>n.trim()).find(n=>n.startsWith(`${t}=`));return i?i.split("=")[1]:null}const a=Object.freeze({PAGE_VIEW:"pageview",SESSION_START:"session_start",SESSION_END:"session_end",SCROLL_DEPTH:"scroll_depth",TIME_ON_PAGE:"time_on_page",CLICK:"click",FORM_VIEW:"form_view",FORM_FOCUS:"form_focus",FORM_SUBMIT:"form_submit",OUTBOUND_LINK_CLICK:"outbound_link_click",VIDEO_PLAY:"video_play",VIDEO_PAUSE:"video_pause",VIDEO_WATCH_PERCENTAGE:"video_watch_percentage",DOWNLOAD:"download"});function E(){if(!u("jw_user_id")){const n=_();p("jw_user_id",n,31536e3)}if(!u("jw_session_id")){const n=_();return p("jw_session_id",n,1800),!0}return!1}function h(){if(typeof window>"u"||typeof document>"u")return!1;const t=typeof navigator<"u"&&navigator.doNotTrack==="1",e=document.cookie.includes("jw_opt_out=true"),i=window.JourneyWiseConsentGiven===!1;return!t&&!e&&!i}function y(){let t=localStorage.getItem("jw_device_id");return t||(t=_(),localStorage.setItem("jw_device_id",t)),t}const I="https://flight.journeywise.io/api/v1/website-event-tracking";function c(t,e){var r,d,s,l;if(!h()||window.JourneyWiseConsentGiven===!1){console.warn("[JourneyWise] Tracking skipped: user opted out or DNT enabled.");return}const i=u("jw_user_id"),n=u("jw_user_id"),o={identifier:t,pageview_id:409606162,platform:"web",user_data:{anonymous_id:i,workEmail:((r=e==null?void 0:e.fields)==null?void 0:r.workEmail)||void 0,firstName:((d=e==null?void 0:e.fields)==null?void 0:d.firstName)||void 0,lastName:((s=e==null?void 0:e.fields)==null?void 0:s.lastName)||void 0,phone:((l=e==null?void 0:e.fields)==null?void 0:l.phoneNumber)||void 0},event:"Website Activity",subEvent:t,metadata:{additional_data:e},referer:e!=null&&e.url?e.url:document.referrer,device_identifier:n,apiKey:window.__JW_API_KEY__||""};fetch(I,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).catch(w=>{console.warn("Failed to send JourneyWise event:",w)})}function S(t){const e={};for(const[i,n]of t.entries())i.toLowerCase(),e[i]=n;return e}let f=Date.now();const D=E();function m(){c(a.PAGE_VIEW,{url:location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:Date.now()}),D&&b(),A(),T(),k(),O()}function k(){const t=window.__JW_API_KEY__;!t||!h()||c("test_connection",{apiKey:t,page_url:location.href,hostname:location.hostname,user_agent:navigator.userAgent,referrer:document.referrer,timestamp:Date.now()})}function b(){const t=u("jw_session_id");c(a.SESSION_START,{session_id:t,timestamp:Date.now()})}function O(){const t=[25,50,75,100],e=new Set;window.addEventListener("scroll",()=>{const i=window.scrollY,n=document.documentElement.scrollHeight-window.innerHeight,o=Math.round(i/n*100);t.forEach(r=>{o>=r&&!e.has(r)&&(e.add(r),c(a.SCROLL_DEPTH,{percent:r,url:location.href,timestamp:Date.now()}))}),f=Date.now()})}function T(){setInterval(()=>{const t=Date.now(),e=Math.floor((t-f)/1e3);c(a.TIME_ON_PAGE,{time_spent:e,url:location.href,session_id:u("jw_session_id"),timestamp:Date.now()})},3e4)}function A(){setInterval(()=>{const e=Date.now();e-f>=5*60*1e3&&c(a.SESSION_END,{session_id:u("jw_session_id"),timestamp:e})},6e4)}function N(){const t=new WeakSet,e=o=>{if(t.has(o))return;t.add(o);const r=o.id||o.name||"unnamed_form";o.addEventListener("invalid",d=>{const s=d.target;c(a.FORM_SUBMIT,{form_id:r,title:o.title||"Unnamed Form",status:"invalid",invalid_fields:[{name:s.name||s.id||"unknown_input",validity:s.validity,validation_message:s.validationMessage}],url:location.href,submit_url:o.action||null,timestamp:Date.now()})},!0),o.addEventListener("submit",d=>{var g;const s=d.submitter;if(!(s&&(s.formNoValidate||((g=s.hasAttribute)==null?void 0:g.call(s,"formnovalidate"))))&&!o.checkValidity())return;const w=new FormData(o),M=S(w);c(a.FORM_SUBMIT,{form_id:r,title:o.title||"Unnamed Form",status:"submitted",fields:M,url:location.href,submit_url:o.action||null,timestamp:Date.now()})})},i=()=>{document.querySelectorAll("form").forEach(e)};i(),new MutationObserver(i).observe(document.body,{childList:!0,subtree:!0})}function L(){const t=["pdf","zip","png","jpg","jpeg","doc","docx","xls","xlsx"];document.addEventListener("click",e=>{const i=e.target.closest("a");if(!i)return;const n=i.getAttribute("href");if(!n)return;const o=new URL(n,location.href),r=o.pathname.split(".").pop().toLowerCase(),d=i.hasAttribute("download"),s=t.includes(r);(d||s)&&c(a.DOWNLOAD,{file_name:o.pathname.split("/").pop(),file_url:o.href,file_extension:r,element_type:"A",page_url:location.href,timestamp:Date.now()})})}function C(){const t=new Set,e=()=>{document.querySelectorAll("video").forEach(n=>{if(t.has(n))return;t.add(n);const o=n.id||"unnamed_video";let r=[25,50,75,100],d=new Set;n.addEventListener("play",()=>{c(a.VIDEO_PLAY,{video_id:o,timestamp:Date.now()})}),n.addEventListener("pause",()=>{c(a.VIDEO_PAUSE,{video_id:o,current_time:n.currentTime,timestamp:Date.now()})}),n.addEventListener("timeupdate",()=>{const s=Math.floor(n.currentTime/n.duration*100);r.forEach(l=>{s>=l&&!d.has(l)&&(d.add(l),c(a.VIDEO_WATCH_PERCENTAGE,{video_id:o,percent_watched:l,timestamp:Date.now()}))})})})};new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0}),e()}function P(t,e={}){const i={...e,url:location.href,timestamp:Date.now(),visitor_id:u("jw_user_id"),session_id:u("jw_session_id"),device_identifier:y()};c(t,i)}function v(t,...e){switch(t){case"init":window.__JW_API_KEY__=e[0];break;case"track":P(...e);break;default:console.warn(`Unknown JourneyWise command: ${t}`)}}function W(t){t.forEach(e=>v(...e))}function j(){const t=history.pushState;history.pushState=function(...e){t.apply(history,e),m()},window.addEventListener("popstate",m)}(function(){var i;const e=((i=window.JourneyWise)==null?void 0:i.q)||[];window.JourneyWise=function(...n){v(...n)},window.JourneyWise.q=e,W(e),E(),setTimeout(()=>{m(),C(),L(),N(),j()},1e3)})()});
