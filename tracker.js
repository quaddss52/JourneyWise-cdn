(function(i){typeof define=="function"&&define.amd?define(i):i()})(function(){"use strict";function i(t,e){const o={event:t,apiKey:window.__JW_API_KEY__||"",data:e};console.log(o,"Sending JourneyWise event")}function w(t){const e={};for(const[o,n]of t.entries()){const s=o.toLowerCase(),r=/email|phone|ssn|password/.test(s);e[o]=r?"[REDACTED]":n}return e}function l(){return crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substr(2,10)}function m(t,e,o){document.cookie=`${t}=${e}; path=/; max-age=${o}`}function a(t){const o=document.cookie.split("; ").map(n=>n.trim()).find(n=>n.startsWith(`${t}=`));return o?o.split("=")[1]:null}function p(){if(!a("jw_user_id")){const n=l();m("jw_user_id",n,31536e3),console.log("[JourneyWise] Visitor ID set:",n)}const o=l();m("jw_session_id",o,1800),console.log("[JourneyWise] Session ID set:",o)}let f=Date.now();function u(){i("page_view",{url:location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:Date.now()}),h(),k(),y(),v()}function h(){const t=a("jw_session_id");i("session_start",{session_id:t,timestamp:Date.now()})}function v(){const t=[25,50,75,100],e=new Set;window.addEventListener("scroll",()=>{const o=window.scrollY,n=document.documentElement.scrollHeight-window.innerHeight,s=Math.round(o/n*100);t.forEach(r=>{s>=r&&!e.has(r)&&(e.add(r),i("scroll_depth",{percent:r,url:location.href,timestamp:Date.now()}))}),f=Date.now()})}function y(){setInterval(()=>{i("time_on_page",{time_spent:30,url:location.href,session_id:a("jw_session_id"),timestamp:Date.now()})},3e4)}function k(){setInterval(()=>{const e=Date.now();e-f>=5*60*1e3&&i("session_end",{session_id:a("jw_session_id"),timestamp:e})},6e4)}function g(){document.addEventListener("click",t=>{const e=t.target.closest("a, button");if(!e)return;const o=e.tagName==="A"&&!e.href.includes(location.hostname),n={element_type:e.tagName,text:e.textContent.trim(),id:e.id||null,class:e.className||null,url:location.href,timestamp:Date.now()};o?(n.link_url=e.href,n.domain=new URL(e.href).hostname,i("outbound_link_click",n)):i("click",n)})}function E(){const t=()=>{document.querySelectorAll("form").forEach(o=>{const n=o.id||o.name||"unnamed_form";i("form_view",{form_id:n,url:location.href,timestamp:Date.now()}),o.querySelectorAll("input, textarea, select").forEach(s=>{s.addEventListener("focus",()=>{i("form_focus",{form_id:n,input_name:s.name||s.id||"unknown_input",url:location.href})})}),o.addEventListener("submit",s=>{const r=new FormData(o),c=w(r);i("form_submit",{form_id:n,status:"submitted",fields:c,url:location.href,timestamp:Date.now()})})})};new MutationObserver(t).observe(document.body,{childList:!0,subtree:!0}),t()}function D(){const t=new Set,e=()=>{document.querySelectorAll("video").forEach(n=>{if(t.has(n))return;t.add(n);const s=n.id||"unnamed_video";let r=[25,50,75,100],c=new Set;n.addEventListener("play",()=>{i("video_play",{video_id:s,timestamp:Date.now()})}),n.addEventListener("pause",()=>{i("video_pause",{video_id:s,current_time:n.currentTime,timestamp:Date.now()})}),n.addEventListener("timeupdate",()=>{const L=Math.floor(n.currentTime/n.duration*100);r.forEach(d=>{L>=d&&!c.has(d)&&(c.add(d),i("video_watch_percentage",{video_id:s,percent_watched:d,timestamp:Date.now()}))})})})};new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0}),e()}function b(t,e={}){const o={...e,url:location.href,timestamp:Date.now(),visitor_id:a("jw_user_id"),session_id:a("jw_session_id")};i(t,o)}function _(t,...e){switch(t){case"init":console.log("JourneyWise initialized with:",e[0]),window.__JW_API_KEY__=e[0];break;case"track":b(...e);break;default:console.warn(`Unknown JourneyWise command: ${t}`)}}function I(t){t.forEach(e=>_(...e))}function S(){const t=history.pushState;history.pushState=function(...e){t.apply(history,e),u()},window.addEventListener("popstate",u)}(function(){var o;const e=((o=window.JourneyWise)==null?void 0:o.q)||[];window.JourneyWise=function(...n){_(...n)},window.JourneyWise.q=e,I(e),p(),u(),g(),D(),E(),S()})()});
