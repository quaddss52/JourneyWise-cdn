(function(l){typeof define=="function"&&define.amd?define(l):l()})(function(){"use strict";function l(){return crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substr(2,10)}function w(t,e,o){document.cookie=`${t}=${e}; path=/; max-age=${o}`}function a(t){if(typeof document>"u")return null;const o=document.cookie.split("; ").map(n=>n.trim()).find(n=>n.startsWith(`${t}=`));return o?o.split("=")[1]:null}const r=Object.freeze({PAGE_VIEW:"pageview",SESSION_START:"session_start",SESSION_END:"session_end",SCROLL_DEPTH:"scroll_depth",TIME_ON_PAGE:"time_on_page",CLICK:"click",FORM_VIEW:"form_view",FORM_FOCUS:"form_focus",FORM_SUBMIT:"form_submit",OUTBOUND_LINK_CLICK:"outbound_link_click",VIDEO_PLAY:"video_play",VIDEO_PAUSE:"video_pause",VIDEO_WATCH_PERCENTAGE:"video_watch_percentage",DOWNLOAD:"download"});function p(){if(!a("jw_user_id")){const n=l();w("jw_user_id",n,31536e3)}if(!a("jw_session_id")){const n=l();return w("jw_session_id",n,1800),!0}return!1}function h(){if(typeof window>"u"||typeof document>"u")return!1;const t=typeof navigator<"u"&&navigator.doNotTrack==="1",e=document.cookie.includes("jw_opt_out=true"),o=window.JourneyWiseConsentGiven===!1;return!t&&!e&&!o}function v(){let t=localStorage.getItem("jw_device_id");return t||(t=l(),localStorage.setItem("jw_device_id",t)),t}const I="https://flight.journeywise.io/api/v1/website-event-tracking";function i(t,e){var s,u,_,d;if(!h()||window.JourneyWiseConsentGiven===!1){console.warn("[JourneyWise] Tracking skipped: user opted out or DNT enabled.");return}const o=a("jw_user_id"),n=a("jw_user_id"),c={identifier:t,pageview_id:409606162,platform:"web",user_data:{anonymous_id:o,workEmail:((s=e==null?void 0:e.fields)==null?void 0:s.workEmail)||void 0,firstName:((u=e==null?void 0:e.fields)==null?void 0:u.firstName)||void 0,lastName:((_=e==null?void 0:e.fields)==null?void 0:_.lastName)||void 0,phone:((d=e==null?void 0:e.fields)==null?void 0:d.phoneNumber)||void 0},event:"Website Activity",subEvent:t,metadata:{additional_data:e},referer:e!=null&&e.url?e.url:document.referrer,device_identifier:n,apiKey:window.__JW_API_KEY__||""};fetch(I,{method:"POST",credentials:"omit",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).catch(j=>{console.warn("Failed to send JourneyWise event:",j)})}function g(t){const e={};for(const[o,n]of t.entries())o.toLowerCase(),e[o]=n;return e}let f=Date.now();const D=p();function m(){i(r.PAGE_VIEW,{url:location.href,referrer:document.referrer,user_agent:navigator.userAgent,timestamp:Date.now()}),D&&S(),T(),O(),y(),k()}function y(){const t=window.__JW_API_KEY__;!t||!h()||i("test_connection",{apiKey:t,page_url:location.href,hostname:location.hostname,user_agent:navigator.userAgent,referrer:document.referrer,timestamp:Date.now()})}function S(){const t=a("jw_session_id");i(r.SESSION_START,{session_id:t,timestamp:Date.now()})}function k(){const t=[25,50,75,100],e=new Set;window.addEventListener("scroll",()=>{const o=window.scrollY,n=document.documentElement.scrollHeight-window.innerHeight,c=Math.round(o/n*100);t.forEach(s=>{c>=s&&!e.has(s)&&(e.add(s),i(r.SCROLL_DEPTH,{percent:s,url:location.href,timestamp:Date.now()}))}),f=Date.now()})}function O(){setInterval(()=>{const t=Date.now(),e=Math.floor((t-f)/1e3);i(r.TIME_ON_PAGE,{time_spent:e,url:location.href,session_id:a("jw_session_id"),timestamp:Date.now()})},3e4)}function T(){setInterval(()=>{const e=Date.now();e-f>=5*60*1e3&&i(r.SESSION_END,{session_id:a("jw_session_id"),timestamp:e})},6e4)}function b(){document.addEventListener("click",t=>{const e=t.target.closest("a, button");if(!e||e.tagName==="BUTTON"&&e.closest("form"))return;const o=e.tagName==="A"&&!e.href.includes(location.hostname),n={element_type:e.tagName,text:e.textContent.trim(),id:e.id||null,class:e.className||null,url:location.href,timestamp:Date.now()};o?(n.link_url=e.href,n.domain=new URL(e.href).hostname,i(r.OUTBOUND_LINK_CLICK,n)):i(r.CLICK,n)})}function A(){const t=()=>{document.querySelectorAll("form").forEach(o=>{const n=o.id||o.name||"unnamed_form";i(r.FORM_VIEW,{form_id:n,url:location.href,timestamp:Date.now()}),o.addEventListener("submit",c=>{c.preventDefault();const s=new FormData(o),u=g(s);i(r.FORM_SUBMIT,{form_id:n,title:o.title||"Unnamed Form",status:"submitted",fields:u,url:location.href,submit_url:o.action||null,timestamp:Date.now()})})})};new MutationObserver(t).observe(document.body,{childList:!0,subtree:!0}),t()}function N(){const t=["pdf","zip","png","jpg","jpeg","doc","docx","xls","xlsx"];document.addEventListener("click",e=>{const o=e.target.closest("a");if(!o)return;const n=o.getAttribute("href");if(!n)return;const c=new URL(n,location.href),s=c.pathname.split(".").pop().toLowerCase(),u=o.hasAttribute("download"),_=t.includes(s);(u||_)&&i(r.DOWNLOAD,{file_name:c.pathname.split("/").pop(),file_url:c.href,file_extension:s,element_type:"A",page_url:location.href,timestamp:Date.now()})})}function L(){const t=new Set,e=()=>{document.querySelectorAll("video").forEach(n=>{if(t.has(n))return;t.add(n);const c=n.id||"unnamed_video";let s=[25,50,75,100],u=new Set;n.addEventListener("play",()=>{i(r.VIDEO_PLAY,{video_id:c,timestamp:Date.now()})}),n.addEventListener("pause",()=>{i(r.VIDEO_PAUSE,{video_id:c,current_time:n.currentTime,timestamp:Date.now()})}),n.addEventListener("timeupdate",()=>{const _=Math.floor(n.currentTime/n.duration*100);s.forEach(d=>{_>=d&&!u.has(d)&&(u.add(d),i(r.VIDEO_WATCH_PERCENTAGE,{video_id:c,percent_watched:d,timestamp:Date.now()}))})})})};new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0}),e()}function C(t,e={}){const o={...e,url:location.href,timestamp:Date.now(),visitor_id:a("jw_user_id"),session_id:a("jw_session_id"),device_identifier:v()};i(t,o)}function E(t,...e){switch(t){case"init":window.__JW_API_KEY__=e[0];break;case"track":C(...e);break;default:console.warn(`Unknown JourneyWise command: ${t}`)}}function P(t){t.forEach(e=>E(...e))}function W(){const t=history.pushState;history.pushState=function(...e){t.apply(history,e),m()},window.addEventListener("popstate",m)}(function(){var o;const e=((o=window.JourneyWise)==null?void 0:o.q)||[];window.JourneyWise=function(...n){E(...n)},window.JourneyWise.q=e,P(e),p(),setTimeout(()=>{m(),b(),L(),N(),A(),W()},1e3)})()});
